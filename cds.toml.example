[model]
name = "communitycats"
# For Ultralytics backend (.pt/.onnx/.engine/.mlpackage/.rknn)
path = "/abs/path/to/model.pt"
# For OpenCV/Darknet fallback backend
cfg_path = "/abs/path/to/yolov-tiny-custom-416v6-64.cfg"
weights_path = "/abs/path/to/yolov-tiny-custom-416v6-64_final.weights"
labels_path = "yolo/cfg/custom-names-v4.txt"
confidence = 0.5
# default: unset (used only for --benchmark frame export band logic; must be > confidence)
confidence_min = ""
nms = 0.5
imgsz = 640
class_filter = ["cat", "cat-domino", "raccoon", "opossum", "skunk"]

[backend_policy]
requested = "auto"
allow_darknet_fallback = true
allow_rknn = true
allow_tensorrt = true

[ingest]
uri = "rtsp://user:pass@camera/stream"
backend = "auto"
queue_size = 2
# Sampling target FPS before inference (default: disabled / unset)
rate_limit_fps = 0.0
# default: "auto" (live=asfast drain, files=source paced, benchmark forces asfast)
clock_mode = "auto"
# default: false (file/directory sources only; process every frame, no-drop queues)
benchmark = false
gstreamer_pipeline = ""

[ingest.pyav_options]
rtsp_transport = "tcp"
fflags = "nobuffer"
flags = "low_delay"
max_delay = "500000"

[output]
headless = false
window_name = "catDetectionSystem"
# default: true (secondary snapshot gallery window)
detections_window_enabled = true
# default: "cds-detections"
detections_window_name = "cds-detections"
# default: 6 snapshots shown per page
detections_window_slots = 6
# default: 0.5 (gallery tile scale)
detections_window_scale = 0.5
# default: 0 => derived as max(frames_detect_on)*3
detections_buffer_frames = 0
remote_enabled = false
remote_host = "0.0.0.0"
remote_port = 8080
remote_path = "/stream.mjpg"
# default: false (benchmark mode only)
export_frames = false
# default: unset (required when export_frames=true)
export_frames_dir = ""
# default: 10.0 percent random sampling within confidence band
export_frames_sample_percent = 10.0

[triggers.audio]
enabled = true
cooldown_seconds = 15.0
# default: 10 consecutive inferred frames to latch ON
frames_detect_on = 10
# default: unset => 50% of frames_detect_on (minimum 1) to latch OFF
frames_detect_off = ""
# default: 0 disables area gate (pixels)
min_area_pixels = 0
# default: 0.0 disables area gate (percent of full frame area)
min_area_percent = 0.0

[triggers.audio.class_to_audio]
cat = "assests/Meow-cat-sound-effect.mp3"

[triggers.hooks]
enabled = false
allowlist = ["/usr/local/bin/cds-hook"]
max_workers = 4
# default: 10 consecutive inferred frames to latch ON
frames_detect_on = 10
# default: unset => 50% of frames_detect_on (minimum 1) to latch OFF
frames_detect_off = ""
# default: 0 disables area gate (pixels)
min_area_pixels = 0
# default: 0.0 disables area gate (percent of full frame area)
min_area_percent = 0.0

[[triggers.hooks.rules]]
classes = ["cat"]
command = ["/usr/local/bin/cds-hook", "cat"]
timeout_seconds = 5.0
cooldown_seconds = 10.0
payload_mode = "stdin"

[monitoring]
json_logs = false
log_level = "INFO"
stats_interval_seconds = 5.0
prometheus_enabled = false
prometheus_host = "0.0.0.0"
prometheus_port = 9108
event_stdout = true
event_file = ""

stress_sleep_ms = 0
